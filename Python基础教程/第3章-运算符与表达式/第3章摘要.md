# 第3章：运算符与表达式

## 目录
- [3.1 什么是运算符和表达式？](#31-什么是运算符和表达式)
- [3.2 算术运算符](#32-算术运算符)
- [3.3 比较运算符](#33-比较运算符)
- [3.4 逻辑运算符](#34-逻辑运算符)
- [3.5 赋值运算符](#35-赋值运算符)
- [3.6 位运算符](#36-位运算符)
- [3.7 成员运算符](#37-成员运算符)
- [3.8 身份运算符](#38-身份运算符)
- [3.9 运算符优先级](#39-运算符优先级)
- [3.10 综合示例](#310-综合示例)
- [3.11 本章练习](#311-本章练习)

---

## 3.1 什么是运算符和表达式？

### 基本概念
- **运算符**：对值（操作数）进行操作的符号，如 `+`、`-`、`*`、`/`
- **操作数**：运算符作用的值，如 `5 + 3` 中的 `5` 和 `3`
- **表达式**：由值、变量、运算符组成的代码片段，能计算出一个结果

```python
# 表达式示例
x = 5 + 3        # 5 + 3 是一个表达式
y = x * 2        # x * 2 是一个表达式
result = (x + y) > 10  # (x + y) > 10 是一个表达式

print(f"x = {x}")      # 8
print(f"y = {y}")      # 16
print(f"result = {result}")  # True (因为 8+16=24 > 10)
```

### 表达式的特点
1. **总是产生一个值**
2. **可以嵌套使用**
3. **可以包含函数调用**
4. **可以赋值给变量**

```python
# 复杂表达式示例
a = 10
b = 3

# 多个运算符的表达式
expression1 = a + b * 2  # 10 + (3*2) = 16
expression2 = (a + b) * 2  # (10+3)*2 = 26
expression3 = a ** 2 + b ** 2  # 100 + 9 = 109

print(f"表达式1: {expression1}")
print(f"表达式2: {expression2}")
print(f"表达式3: {expression3}")

# 包含函数调用的表达式
import math
circle_area = math.pi * 5 ** 2  # π × r²
print(f"半径为5的圆面积: {circle_area:.2f}")
```

---

## 3.2 算术运算符

用于基本数学运算的运算符。

### 基本算术运算符
```python
# 基本算术运算
a = 10
b = 3

print(f"a = {a}, b = {b}")
print("=" * 30)

# 1. 加法 +
sum_result = a + b
print(f"加法: {a} + {b} = {sum_result}")

# 2. 减法 -
difference = a - b
print(f"减法: {a} - {b} = {difference}")

# 3. 乘法 *
product = a * b
print(f"乘法: {a} × {b} = {product}")

# 4. 除法 / (浮点数除法)
division = a / b
print(f"除法: {a} ÷ {b} = {division:.3f}")  # 3.333

# 5. 整除 // (向下取整)
floor_division = a // b
print(f"整除: {a} // {b} = {floor_division}")  # 3

# 6. 取余 % (模运算)
remainder = a % b
print(f"取余: {a} % {b} = {remainder}")  # 1

# 7. 幂运算 **
power = a ** b
print(f"幂运算: {a} ** {b} = {power}")  # 1000

# 负数运算
negative_a = -a
print(f"负数: -{a} = {negative_a}")
```

### 整除和取余的实际应用
```python
# 应用1：判断奇偶数
number = 17
if number % 2 == 0:
    print(f"{number} 是偶数")
else:
    print(f"{number} 是奇数")

# 应用2：时间转换
total_seconds = 3675
hours = total_seconds // 3600  # 整除得到小时
remaining_seconds = total_seconds % 3600  # 取余得到剩余秒数
minutes = remaining_seconds // 60
seconds = remaining_seconds % 60

print(f"{total_seconds}秒 = {hours}小时{minutes}分钟{seconds}秒")

# 应用3：数字分离
number = 1234
thousands = number // 1000
hundreds = (number % 1000) // 100
tens = (number % 100) // 10
units = number % 10

print(f"数字 {number}:")
print(f"  千位: {thousands}")
print(f"  百位: {hundreds}")
print(f"  十位: {tens}")
print(f"  个位: {units}")
```

### 浮点数精度问题
```python
# 注意：浮点数计算可能有精度问题
print(0.1 + 0.2)  # 0.30000000000000004，不是精确的0.3
print(0.1 + 0.2 == 0.3)  # False！

# 解决方案：使用decimal模块或比较时允许误差
import math

# 方法1：使用decimal模块（精确计算）
from decimal import Decimal
result = Decimal('0.1') + Decimal('0.2')
print(f"精确计算: {result}")  # 0.3

# 方法2：允许小的误差
def is_close(a, b, tolerance=1e-10):
    return abs(a - b) < tolerance

print(f"近似相等: {is_close(0.1 + 0.2, 0.3)}")  # True

# 方法3：使用math.isclose()
print(f"math.isclose: {math.isclose(0.1 + 0.2, 0.3)}")  # True
```

---

## 3.3 比较运算符

用于比较两个值，返回布尔值（True/False）。

### 基本比较运算符
```python
x = 10
y = 5

print(f"x = {x}, y = {y}")
print("=" * 30)

# 1. 等于 ==
print(f"x == y: {x == y}")      # False

# 2. 不等于 !=
print(f"x != y: {x != y}")      # True

# 3. 大于 >
print(f"x > y: {x > y}")        # True

# 4. 小于 <
print(f"x < y: {x < y}")        # False

# 5. 大于等于 >=
print(f"x >= y: {x >= y}")      # True

# 6. 小于等于 <=
print(f"x <= y: {x <= y}")      # False

# 字符串比较（按字典序）
str1 = "apple"
str2 = "banana"
print(f"'{str1}' < '{str2}': {str1 < str2}")  # True
print(f"'{str1}' == 'apple': {str1 == 'apple'}")  # True
```

### 链式比较
Python 支持链式比较，使代码更简洁：
```python
age = 25

# 传统写法
if age >= 18 and age <= 60:
    print("成年人")

# 链式比较写法
if 18 <= age <= 60:
    print("成年人")

# 更多链式比较示例
x = 5
print(f"1 < x < 10: {1 < x < 10}")  # True
print(f"0 <= x <= 5: {0 <= x <= 5}")  # True
print(f"x == 5 or x == 6: {x == 5 or x == 6}")  # True
```

### 浮点数比较注意事项
```python
# 浮点数比较不要直接用 ==
a = 0.1 + 0.2
b = 0.3

print(f"a = {a}, b = {b}")
print(f"a == b: {a == b}")  # False（有精度误差）

# 正确做法：比较差值是否小于某个很小的数
epsilon = 1e-10
print(f"abs(a - b) < epsilon: {abs(a - b) < epsilon}")  # True

# 或使用 math.isclose()
import math
print(f"math.isclose(a, b): {math.isclose(a, b)}")  # True
```

---

## 3.4 逻辑运算符

用于组合多个条件，返回布尔值。

### 基本逻辑运算符
```python
# 定义一些布尔变量
is_weekend = True
is_sunny = False
has_money = True
is_tired = False

print("初始条件:")
print(f"  周末: {is_weekend}")
print(f"  晴天: {is_sunny}")
print(f"  有钱: {has_money}")
print(f"  疲劳: {is_tired}")
print("=" * 30)

# 1. 与运算 and (两个都为True才是True)
go_outside = is_weekend and is_sunny
print(f"出门条件 (周末且晴天): {go_outside}")  # False

# 2. 或运算 or (有一个为True就是True)
can_buy_coffee = is_weekend or has_money
print(f"买咖啡条件 (周末或有钱): {can_buy_coffee}")  # True

# 3. 非运算 not (取反)
not_tired = not is_tired
print(f"不疲劳: {not_tired}")  # True

# 组合逻辑运算
complex_condition = (is_weekend and is_sunny) or (has_money and not is_tired)
print(f"复杂条件: {complex_condition}")  # True
```

### 逻辑运算符的真值表
```python
print("AND 真值表:")
print("True and True =", True and True)    # True
print("True and False =", True and False)   # False
print("False and True =", False and True)   # False
print("False and False =", False and False) # False

print("\nOR 真值表:")
print("True or True =", True or True)      # True
print("True or False =", True or False)     # True
print("False or True =", False or True)     # True
print("False or False =", False or False)   # False

print("\nNOT 真值表:")
print("not True =", not True)              # False
print("not False =", not False)             # True
```

### 短路求值
Python 逻辑运算符使用短路求值（short-circuit evaluation）：
- `and`：如果第一个操作数为 False，直接返回 False，不计算第二个
- `or`：如果第一个操作数为 True，直接返回 True，不计算第二个

```python
# 短路求值示例
def expensive_operation():
    print("执行了昂贵的操作！")
    return True

# 情况1：and 运算符的短路
result1 = False and expensive_operation()  # expensive_operation 不会执行
print(f"result1 = {result1}")

# 情况2：or 运算符的短路
result2 = True or expensive_operation()    # expensive_operation 不会执行
print(f"result2 = {result2}")

# 情况3：没有短路
result3 = True and expensive_operation()   # expensive_operation 会执行
print(f"result3 = {result3}")

# 实际应用：避免除零错误
def safe_division(a, b):
    # 使用短路求值避免 b == 0 的情况
    return b != 0 and a / b

print(f"safe_division(10, 2) = {safe_division(10, 2)}")   # 5.0
print(f"safe_division(10, 0) = {safe_division(10, 0)}")   # False
```

---

## 3.5 赋值运算符

用于给变量赋值，包括复合赋值运算符。

### 基本赋值运算符
```python
# 简单赋值
x = 10
print(f"x = {x}")

# 多重赋值
a = b = c = 0
print(f"a={a}, b={b}, c={c}")

# 同时给多个变量赋不同值
x, y, z = 1, 2, 3
print(f"x={x}, y={y}, z={z}")

# 交换两个变量的值（Python特色）
a, b = 10, 20
print(f"交换前: a={a}, b={b}")
a, b = b, a  # 交换！
print(f"交换后: a={a}, b={b}")
```

### 复合赋值运算符
```python
# 初始化变量
total = 10
print(f"初始值: total = {total}")
print("=" * 30)

# 1. 加法赋值 +=
total += 5  # 等价于 total = total + 5
print(f"total += 5  → total = {total}")

# 2. 减法赋值 -=
total -= 3  # 等价于 total = total - 3
print(f"total -= 3  → total = {total}")

# 3. 乘法赋值 *=
total *= 2  # 等价于 total = total * 2
print(f"total *= 2  → total = {total}")

# 4. 除法赋值 /=
total /= 4  # 等价于 total = total / 4
print(f"total /= 4  → total = {total}")

# 5. 整除赋值 //=
total = 10  # 重置
total //= 3  # 等价于 total = total // 3
print(f"total //= 3 → total = {total}")

# 6. 取余赋值 %=
total = 10  # 重置
total %= 3  # 等价于 total = total % 3
print(f"total %= 3  → total = {total}")

# 7. 幂赋值 **=
total = 2  # 重置
total **= 3  # 等价于 total = total ** 3
print(f"total **= 3 → total = {total}")

# 字符串也可以使用 +=
text = "Hello"
text += " World!"
print(f"text += ' World!' → '{text}'")
```

### 增强赋值与普通赋值的区别
```python
# 对于可变对象（如列表），增强赋值可能就地修改
list1 = [1, 2, 3]
list2 = list1  # list2 是 list1 的引用

print(f"初始: list1 = {list1}, list2 = {list2}")

# 增强赋值（就地修改）
list1 += [4, 5]  # 等价于 list1.extend([4, 5])
print(f"list1 += [4, 5]:")
print(f"  list1 = {list1}")  # [1, 2, 3, 4, 5]
print(f"  list2 = {list2}")  # [1, 2, 3, 4, 5] (也被修改了！)

# 重置
list1 = [1, 2, 3]
list2 = list1

# 普通赋值（创建新对象）
list1 = list1 + [4, 5]  # 创建新列表
print(f"\nlist1 = list1 + [4, 5]:")
print(f"  list1 = {list1}")  # [1, 2, 3, 4, 5]
print(f"  list2 = {list2}")  # [1, 2, 3] (没有改变)
```

---

## 3.6 位运算符

用于对整数进行二进制位操作。

### 基本位运算符
```python
# 定义两个整数（查看它们的二进制表示）
a = 10  # 二进制: 1010
b = 6   # 二进制: 0110

print(f"a = {a} (二进制: {bin(a)})")
print(f"b = {b} (二进制: {bin(b)})")
print("=" * 40)

# 1. 按位与 & (两位都为1时结果为1)
result_and = a & b  # 1010 & 0110 = 0010 (十进制2)
print(f"按位与 a & b: {a} & {b} = {result_and}")
print(f"  二进制: {bin(a)} & {bin(b)} = {bin(result_and)}")

# 2. 按位或 | (有一位为1时结果为1)
result_or = a | b  # 1010 | 0110 = 1110 (十进制14)
print(f"\n按位或 a | b: {a} | {b} = {result_or}")
print(f"  二进制: {bin(a)} | {bin(b)} = {bin(result_or)}")

# 3. 按位异或 ^ (两位不同时结果为1)
result_xor = a ^ b  # 1010 ^ 0110 = 1100 (十进制12)
print(f"\n按位异或 a ^ b: {a} ^ {b} = {result_xor}")
print(f"  二进制: {bin(a)} ^ {bin(b)} = {bin(result_xor)}")

# 4. 按位取反 ~ (0变1, 1变0)
result_not = ~a  # ~1010 = ...11110101 (补码表示)
print(f"\n按位取反 ~a: ~{a} = {result_not}")
print(f"  说明: Python使用补码表示负数")

# 5. 左移 << (二进制位向左移动，右侧补0)
result_left = a << 1  # 1010 << 1 = 10100 (十进制20)
print(f"\n左移 a << 1: {a} << 1 = {result_left}")
print(f"  二进制: {bin(a)} << 1 = {bin(result_left)}")

# 6. 右移 >> (二进制位向右移动)
result_right = a >> 1  # 1010 >> 1 = 0101 (十进制5)
print(f"\n右移 a >> 1: {a} >> 1 = {result_right}")
print(f"  二进制: {bin(a)} >> 1 = {bin(result_right)}")
```

### 位运算的实际应用
```python
# 应用1：判断奇偶数（更高效的方法）
def is_even(n):
    """使用位运算判断是否为偶数"""
    # n & 1 的结果：奇数=1，偶数=0
    return (n & 1) == 0

print("判断奇偶数:")
for num in range(5):
    print(f"  {num} 是{'偶数' if is_even(num) else '奇数'}")

# 应用2：乘除2的幂次（更高效）
n = 20
print(f"\n原始值: {n}")
print(f"n × 8 = {n * 8} (普通乘法)")
print(f"n << 3 = {n << 3} (左移3位，相当于×8)")

print(f"\nn ÷ 4 = {n // 4} (普通除法)")
print(f"n >> 2 = {n >> 2} (右移2位，相当于÷4)")

# 应用3：设置、清除和切换位
def set_bit(n, position):
    """设置指定位为1"""
    return n | (1 << position)

def clear_bit(n, position):
    """清除指定位（设为0）"""
    return n & ~(1 << position)

def toggle_bit(n, position):
    """切换指定位（0变1，1变0）"""
    return n ^ (1 << position)

def check_bit(n, position):
    """检查指定位是否为1"""
    return (n >> position) & 1

# 测试位操作
value = 0b1010  # 十进制10
print(f"\n原始值: {value} (二进制: {bin(value)})")

value = set_bit(value, 1)  # 设置第1位（从0开始）
print(f"设置第1位后: {value} (二进制: {bin(value)})")

value = clear_bit(value, 3)  # 清除第3位
print(f"清除第3位后: {value} (二进制: {bin(value)})")

value = toggle_bit(value, 0)  # 切换第0位
print(f"切换第0位后: {value} (二进制: {bin(value)})")

print(f"检查第2位: {'是1' if check_bit(value, 2) else '是0'}")
```

---

## 3.7 成员运算符

用于测试序列（字符串、列表、元组、字典、集合）中是否包含某个成员。

### 基本成员运算符
```python
# 定义测试数据
fruits = ["apple", "banana", "orange", "grape"]
word = "hello world"
student_scores = {"Alice": 95, "Bob": 88, "Charlie": 92}

print("测试数据:")
print(f"  fruits = {fruits}")
print(f"  word = '{word}'")
print(f"  student_scores = {student_scores}")
print("=" * 40)

# 1. in 运算符（是否包含）
print("in 运算符测试:")
print(f"  'banana' in fruits: {'banana' in fruits}")  # True
print(f"  'watermelon' in fruits: {'watermelon' in fruits}")  # False
print(f"  'world' in word: {'world' in word}")  # True
print(f"  'Alice' in student_scores: {'Alice' in student_scores}")  # True（检查键）
print(f"   95 in student_scores: {95 in student_scores}")  # False（不检查值）

# 2. not in 运算符（是否不包含）
print("\nnot in 运算符测试:")
print(f"  'cherry' not in fruits: {'cherry' not in fruits}")  # True
print(f"  'banana' not in fruits: {'banana' not in fruits}")  # False
print(f"  'z' not in word: {'z' not in word}")  # True
```

### 成员运算符的实际应用
```python
# 应用1：用户输入验证
valid_colors = ["red", "green", "blue", "yellow", "purple"]

user_color = input("请选择颜色 (红/绿/蓝/黄/紫): ")

if user_color in valid_colors:
    print(f"你选择了 {user_color}")
else:
    print(f"错误: {user_color} 不是有效颜色")
    print(f"有效颜色: {', '.join(valid_colors)}")

# 应用2：密码强度检查
def check_password_strength(password):
    """检查密码强度"""
    errors = []
    
    # 检查长度
    if len(password) < 8:
        errors.append("密码长度至少8位")
    
    # 检查是否包含数字
    if not any(char.isdigit() for char in password):
        errors.append("密码必须包含数字")
    
    # 检查是否包含大写字母
    if not any(char.isupper() for char in password):
        errors.append("密码必须包含大写字母")
    
    # 检查是否包含小写字母
    if not any(char.islower() for char in password):
        errors.append("密码必须包含小写字母")
    
    # 检查是否包含特殊字符
    special_chars = "!@#$%^&*"
    if not any(char in special_chars for char in password):
        errors.append("密码必须包含特殊字符 (!@#$%^&*)")
    
    return errors

# 测试密码检查
test_passwords = ["weak", "Weak123", "Strong@123", "VERYSTRONG@2024"]
for pwd in test_passwords:
    errors = check_password_strength(pwd)
    if errors:
        print(f"'{pwd}': 弱 - {errors}")
    else:
        print(f"'{pwd}': 强")

# 应用3：数据过滤
all_students = ["Alice", "Bob", "Charlie", "David", "Eve"]
present_students = ["Alice", "Charlie", "Eve"]

# 找出缺席的学生
absent_students = [student for student in all_students 
                   if student not in present_students]

print(f"\n所有学生: {all_students}")
print(f"出席学生: {present_students}")
print(f"缺席学生: {absent_students}")
```

---

## 3.8 身份运算符

用于比较两个对象的内存地址（是否指向同一个对象）。

### 基本身份运算符
```python
# 身份运算符比较的是内存地址，不是值
a = [1, 2, 3]
b = [1, 2, 3]  # 值相同，但是不同的对象
c = a  # c 和 a 指向同一个对象

print(f"a = {a}, id(a) = {id(a)}")
print(f"b = {b}, id(b) = {id(b)}")
print(f"c = {c}, id(c) = {id(c)}")
print("=" * 40)

# 1. is 运算符（是否是同一个对象）
print("is 运算符测试:")
print(f"  a is b: {a is b}")  # False（不同对象）
print(f"  a is c: {a is c}")  # True（同一对象）

# 2. is not 运算符（是否不是同一个对象）
print("\nis not 运算符测试:")
print(f"  a is not b: {a is not b}")  # True
print(f"  a is not c: {a is not c}")  # False

# 比较运算符 vs 身份运算符
print("\n比较运算符 vs 身份运算符:")
print(f"  a == b: {a == b}")  # True（值相等）
print(f"  a is b: {a is b}")  # False（不是同一对象）
```

### 小整数缓存机制
Python 对小整数（-5 到 256）有缓存机制：
```python
# 小整数缓存
x = 100
y = 100
print(f"x = 100, y = 100")
print(f"x is y: {x is y}")  # True（同一对象，因为缓存）

# 大整数没有缓存
x = 1000
y = 1000
print(f"\nx = 1000, y = 1000")
print(f"x is y: {x is y}")  # 可能True也可能False，取决于Python实现
print(f"x == y: {x == y}")  # True（值相等）

# 字符串驻留
s1 = "hello"
s2 = "hello"
print(f"\ns1 = 'hello', s2 = 'hello'")
print(f"s1 is s2: {s1 is s2}")  # True（字符串驻留）

s3 = "hello world!"
s4 = "hello world!"
print(f"\ns3 = 'hello world!', s4 = 'hello world!'")
print(f"s3 is s4: {s3 is s4}")  # 可能True也可能False
```

### 身份运算符的实际应用
```python
# 应用1：检查变量是否为None（正确做法）
value = None

# 正确：使用 is None 或 is not None
if value is None:
    print("value 是 None")

# 错误：使用 == None（技术上可行，但不推荐）
if value == None:
    print("value == None 也能工作，但不推荐")

# 应用2：单例模式检查
class DatabaseConnection:
    _instance = None
    
    def __new__(cls):
        if cls._instance is None:
            print("创建新的数据库连接")
            cls._instance = super().__new__(cls)
        else:
            print("返回现有的数据库连接")
        return cls._instance

# 测试单例模式
print("测试单例模式:")
db1 = DatabaseConnection()  # 创建新的
db2 = DatabaseConnection()  # 返回现有的

print(f"db1 is db2: {db1 is db2}")  # True

# 应用3：避免意外修改共享对象
def process_data(data):
    """处理数据，如果data是None则创建新列表"""
    if data is None:
        data = []  # 创建新列表
    data.append("processed")
    return data

# 测试
original_list = [1, 2, 3]
result1 = process_data(original_list)
print(f"\noriginal_list: {original_list}")  # [1, 2, 3, 'processed']
print(f"result1: {result1}")  # [1, 2, 3, 'processed']
print(f"original_list is result1: {original_list is result1}")  # True

result2 = process_data(None)
print(f"\nresult2: {result2}")  # ['processed']
```

---

## 3.9 运算符优先级

运算符优先级决定了表达式中运算的执行顺序。

### Python 运算符优先级表（从高到低）

| 优先级 | 运算符 | 描述 |
|--------|--------|------|
| 1 | `()` | 括号（最高优先级） |
| 2 | `**` | 幂运算 |
| 3 | `+x`, `-x`, `~x` | 正号、负号、按位取反 |
| 4 | `*`, `/`, `//`, `%` | 乘、除、整除、取余 |
| 5 | `+`, `-` | 加、减 |
| 6 | `<<`, `>>` | 左移、右移 |
| 7 | `&` | 按位与 |
| 8 | `^` | 按位异或 |
| 9 | `|` | 按位或 |
| 10 | `==`, `!=`, `>`, `<`, `>=`, `<=`, `is`, `is not`, `in`, `not in` | 比较、身份、成员运算符 |
| 11 | `not` | 逻辑非 |
| 12 | `and` | 逻辑与 |
| 13 | `or` | 逻辑或（最低优先级） |

### 优先级示例
```python
# 示例1：算术运算符优先级
result1 = 2 + 3 * 4  # 3*4先计算，然后+2 = 14
result2 = (2 + 3) * 4  # 括号优先，2+3=5，然后*4 = 20
print(f"2 + 3 * 4 = {result1}")
print(f"(2 + 3) * 4 = {result2}")

# 示例2：混合运算符
result3 = 5 + 2 ** 3 * 2  # 2**3=8, 8*2=16, 5+16=21
print(f"5 + 2 ** 3 * 2 = {result3}")

# 示例3：比较和逻辑运算符
a, b, c = 5, 10, 15
result4 = a < b and b < c  # 等价于 (a < b) and (b < c)
result5 = a < b < c  # 链式比较，更简洁
print(f"a < b and b < c = {result4}")
print(f"a < b < c = {result5}")

# 示例4：容易混淆的情况
x = 5
y = 10
z = 15

# 注意：比较运算符优先级高于逻辑运算符
result6 = x < y and y < z  # 正确：(x < y) and (y < z)
result7 = x < y or y > z and z > x  # 等价于 (x < y) or ((y > z) and (z > x))
print(f"x < y and y < z = {result6}")
print(f"x < y or y > z and z > x = {result7}")
```

### 使用括号明确优先级
```python
# 最佳实践：使用括号使意图清晰
# 即使知道优先级，也建议使用括号增加可读性

# 模糊的表达式
ambiguous = 5 + 3 * 2 ** 2 / 4 - 1

# 清晰的表达式（使用括号）
clear = 5 + ((3 * (2 ** 2)) / 4) - 1

print(f"模糊表达式: 5 + 3 * 2 ** 2 / 4 - 1 = {ambiguous}")
print(f"清晰表达式: 5 + ((3 * (2 ** 2)) / 4) - 1 = {clear}")

# 复杂逻辑表达式使用括号
age = 25
has_license = True
has_car = False

# 模糊
can_drive = age >= 18 and has_license or has_car

# 清晰
can_drive_clear = (age >= 18 and has_license) or has_car

print(f"\n模糊: age >= 18 and has_license or has_car = {can_drive}")
print(f"清晰: (age >= 18 and has_license) or has_car = {can_drive_clear}")
```

### 优先级助记口诀
```
括、幂、单、乘除、加减，
移位、与、异或、或，
比较、身份、成员间，
非、与、或最低端。
```

---

## 3.10 综合示例

### 示例1：简易计算器
```python
"""
简易计算器 - 运算符综合应用
"""

def simple_calculator():
    """简易四则运算计算器"""
    print("简易计算器")
    print("=" * 30)
    
    try:
        # 获取输入
        num1 = float(input("请输入第一个数字: "))
        operator = input("请选择运算符 (+, -, *, /, //, %, **): ")
        num2 = float(input("请输入第二个数字: "))
        
        # 根据运算符计算
        if operator == "+":
            result = num1 + num2
        elif operator == "-":
            result = num1 - num2
        elif operator == "*":
            result = num1 * num2
        elif operator == "/":
            if num2 == 0:
                print("错误: 除数不能为0!")
                return
            result = num1 / num2
        elif operator == "//":
            if num2 == 0:
                print("错误: 除数不能为0!")
                return
            result = num1 // num2
        elif operator == "%":
            if num2 == 0:
                print("错误: 除数不能为0!")
                return
            result = num1 % num2
        elif operator == "**":
            result = num1 ** num2
        else:
            print(f"错误: 不支持的操作符 '{operator}'")
            return
        
        # 输出结果
        print(f"\n计算结果: {num1} {operator} {num2} = {result}")
        
        # 额外信息
        if operator in ["/", "//"] and num2 != 0:
            print(f"  验证: {num1} = {num2} × {result} + {num1 % num2}")
        
    except ValueError:
        print("错误: 请输入有效的数字!")

# 运行计算器
simple_calculator()
```

### 示例2：学生成绩分析
```python
"""
学生成绩分析系统
"""

def analyze_scores():
    """分析学生成绩"""
    print("学生成绩分析系统")
    print("=" * 40)
    
    # 输入学生成绩
    scores_input = input("请输入学生成绩（用空格分隔）: ")
    scores = [float(score) for score in scores_input.split()]
    
    if not scores:
        print("错误: 没有输入成绩!")
        return
    
    # 计算统计信息
    total_students = len(scores)
    highest_score = max(scores)
    lowest_score = min(scores)
    average_score = sum(scores) / total_students
    
    # 统计等级
    grade_a = len([s for s in scores if s >= 90])
    grade_b = len([s for s in scores if 80 <= s < 90])
    grade_c = len([s for s in scores if 70 <= s < 80])
    grade_d = len([s for s in scores if 60 <= s < 70])
    grade_f = len([s for s in scores if s < 60])
    
    # 输出结果
    print(f"\n成绩分析结果:")
    print(f"  学生总数: {total_students}")
    print(f"  最高分: {highest_score}")
    print(f"  最低分: {lowest_score}")
    print(f"  平均分: {average_score:.2f}")
    print(f"  分数范围: {lowest_score} - {highest_score}")
    
    print(f"\n等级分布:")
    print(f"  A (90-100): {grade_a} 人 ({grade_a/total_students*100:.1f}%)")
    print(f"  B (80-89):  {grade_b} 人 ({grade_b/total_students*100:.1f}%)")
    print(f"  C (70-79):  {grade_c} 人 ({grade_c/total_students*100:.1f}%)")
    print(f"  D (60-69):  {grade_d} 人 ({grade_d/total_students*100:.1f}%)")
    print(f"  F (<60):    {grade_f} 人 ({grade_f/total_students*100:.1f}%)")
    
    # 额外分析
    print(f"\n额外分析:")
    print(f"  平均分 {'≥' if average_score >= 60 else '<'} 60: {'及格' if average_score >= 60 else '不及格'}")
    
    # 找出优秀学生（≥90）和需要帮助的学生（<60）
    excellent_students = [f"第{i+1}位" for i, s in enumerate(scores) if s >= 90]
    need_help_students = [f"第{i+1}位" for i, s in enumerate(scores) if s < 60]
    
    if excellent_students:
        print(f"  优秀学生: {', '.join(excellent_students)}")
    if need_help_students:
        print(f"  需要帮助的学生: {', '.join(need_help_students)}")

# 运行分析系统
analyze_scores()
```

### 示例3：权限检查系统
```python
"""
权限检查系统 - 逻辑运算符综合应用
"""

def check_permission():
    """检查用户权限"""
    print("权限检查系统")
    print("=" * 40)
    
    # 模拟用户信息
    user_roles = {
        "admin": ["read", "write", "delete", "manage_users"],
        "editor": ["read", "write"],
        "viewer": ["read"]
    }
    
    # 用户输入
    username = input("用户名: ").strip()
    role = input("角色 (admin/editor/viewer): ").strip().lower()
    requested_permission = input("请求的权限 (read/write/delete/manage_users): ").strip().lower()
    
    # 验证输入
    if not username:
        print("错误: 用户名不能为空!")
        return
    
    if role not in user_roles:
        print(f"错误: 无效的角色 '{role}'")
        print(f"有效角色: {', '.join(user_roles.keys())}")
        return
    
    # 检查权限
    user_permissions = user_roles[role]
    has_permission = requested_permission in user_permissions
    
    # 输出结果
    print(f"\n权限检查结果:")
    print(f"  用户名: {username}")
    print(f"  角色: {role}")
    print(f"  请求权限: {requested_permission}")
    print(f"  用户权限: {', '.join(user_permissions)}")
    print(f"  权限 {'已授予' if has_permission else '拒绝'}: {has_permission}")
    
    # 详细权限说明
    print(f"\n详细权限说明:")
    print(f"  read: 读取内容")
    print(f"  write: 创建和编辑内容")
    print(f"  delete: 删除内容")
    print(f"  manage_users: 管理用户账户")
    
    # 角色能力对比
    print(f"\n不同角色的能力:")
    for r, perms in user_roles.items():
        icon = "✓" if requested_permission in perms else "✗"
        print(f"  {r}: {icon} {requested_permission}")

# 运行权限检查
check_permission()
```

---

## 3.11 本章练习

### 练习1：表达式计算
计算以下表达式的结果（先手算，再用Python验证）：
```python
# 表达式列表
expressions = [
    "2 + 3 * 4",
    "(2 + 3) * 4",
    "2 ** 3 * 2",
    "10 / 3",
    "10 // 3",
    "10 % 3",
    "5 & 3",      # 按位与
    "5 | 3",      # 按位或
    "5 ^ 3",      # 按位异或
    "~5",         # 按位取反
    "5 << 1",     # 左移1位
    "5 >> 1"      # 右移1位
]

# 你的任务：预测结果，然后用Python验证
```

### 练习2：逻辑表达式分析
分析以下逻辑表达式，对于给定的变量值，判断表达式的结果：

```python
x = 5
y = 10
z = 15
flag = True
text = "hello"

expressions = [
    "x < y and y < z",
    "x < y or y > z",
    "not flag",
    "not x > y",
    "'h' in text and 'o' in text",
    "text == 'hello' or text == 'world'",
    "x is not None and y is not None",
    "(x + y) > 20 and (y - x) < 10"
]

# 你的任务：预测每个表达式的结果
```

### 练习3：位运算挑战
编写函数完成以下位运算任务：
1. 判断一个整数是否是2的幂
2. 统计一个整数的二进制表示中有多少个1
3. 反转一个整数的二进制位（如：0b1011 → 0b1101）
4. 交换一个整数的奇数位和偶数位

### 练习4：复合赋值练习
分析以下代码的输出：
```python
a = 10
b = 3

a += b  # a = ?
print(f"a += b → a = {a}")

a -= b  # a = ?
print(f"a -= b → a = {a}")

a *= b  # a = ?
print(f"a *= b → a = {a}")

a //= b  # a = ?
print(f"a //= b → a = {a}")

a **= b  # a = ?
print(f"a **= b → a = {a}")
```

### 练习5：表达式重构
将以下复杂的表达式重构为更易读的形式：
```python
# 原始表达式
result = a + b * c - d / e + f ** g % h

# 重构要求：
# 1. 使用括号明确优先级
# 2. 分解为多个步骤（如果太复杂）
# 3. 添加注释说明计算顺序

# 另一个例子
permission = age >= 18 and has_id or parent_consent and age >= 16
```

### 练习6：综合应用题
编写一个程序，实现以下功能：
1. 输入一个三位整数
2. 分别提取百位、十位、个位数字
3. 计算：
   - 三个数字的和
   - 三个数字的乘积
   - 判断是否是水仙花数（各位数字立方和等于原数）
4. 输出所有计算结果

示例：
```
输入: 153
输出:
  百位: 1, 十位: 5, 个位: 3
  和: 9
  乘积: 15
  是水仙花数: 是 (1³+5³+3³=153)
```

---

## 总结

本章中，你学习了：
- ✅ **算术运算符**：`+`, `-`, `*`, `/`, `//`, `%`, `**`
- ✅ **比较运算符**：`==`, `!=`, `>`, `<`, `>=`, `<=`
- ✅ **逻辑运算符**：`and`, `or`, `not`（注意短路求值）
- ✅ **赋值运算符**：`=`, `+=`, `-=`, `*=`, `/=`, `//=`, `%=`, `**=`
- ✅ **位运算符**：`&`, `|`, `^`, `~`, `<<`, `>>`
- ✅ **成员运算符**：`in`, `not in`
- ✅ **身份运算符**：`is`, `is not`
- ✅ **运算符优先级**和括号的使用

**关键要点**：
1. 理解不同类型运算符的用途和区别
2. 掌握运算符优先级，必要时使用括号
3. 注意浮点数计算的精度问题
4. 了解短路求值在逻辑运算中的应用
5. 区分 `==`（值相等）和 `is`（同一对象）

**编程建议**：
- 复杂表达式使用括号增加可读性
- 使用 `is` 检查 `None`，而不是 `==`
- 了解位运算的高效应用场景
- 优先使用链式比较简化代码

---

## 扩展知识
- [Python 运算符官方文档](https://docs.python.org/zh-cn/3/library/operator.html)
- [Python 运算符优先级官方说明](https://docs.python.org/zh-cn/3/reference/expressions.html#operator-precedence)
- [位运算技巧](https://wiki.python.org/moin/BitwiseOperators)

---
**下一章**：[第4章：控制流程]

> 如果有任何问题，欢迎在 [Issues](https://github.com/SuperF2023/python-basics-tutorial/issues) 中提问！